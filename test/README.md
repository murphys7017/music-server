# æµ‹è¯•æ–‡ä»¶è¯´æ˜ / Test Files Documentation

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶åˆ—è¡¨ / Test Files

### 1. test_message_queue.py
**æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿæµ‹è¯•**

æµ‹è¯•å†…å®¹:
- âœ… åŸºæœ¬ä»»åŠ¡é˜Ÿåˆ—åŠŸèƒ½
- âœ… å…¬å…±ä¿¡æ¯å­˜å‚¨
- âœ… TTLè¿‡æœŸæœºåˆ¶
- âœ… å¤šWorkerå¹¶å‘å¤„ç†
- âœ… Bç«™ä¸‹è½½åœºæ™¯æ¨¡æ‹Ÿ

è¿è¡Œæµ‹è¯•:
```bash
python test/test_message_queue.py
```

### 2. test_scheduler.py
**å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨æµ‹è¯•**

æµ‹è¯•å†…å®¹:
- âœ… é—´éš”è°ƒåº¦ä»»åŠ¡ (interval)
- âœ… å•æ¬¡æ‰§è¡Œä»»åŠ¡ (once)
- âœ… Cronè¡¨è¾¾å¼ä»»åŠ¡ (cron)
- âœ… ä»»åŠ¡ç®¡ç†åŠŸèƒ½ (æš‚åœ/æ¢å¤/åˆ é™¤)
- âœ… Bç«™ä¸‹è½½åœºæ™¯æ¨¡æ‹Ÿ

è¿è¡Œæµ‹è¯•:
```bash
python test/test_scheduler.py
```

## ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯• / Run All Tests

### æ–¹æ³•1: é€ä¸ªè¿è¡Œ
```bash
python test/test_message_queue.py
python test/test_scheduler.py
```

### æ–¹æ³•2: ä½¿ç”¨æµ‹è¯•æ¡†æ¶ (å¯é€‰)
```bash
# å®‰è£… pytest
pip install pytest

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest test/

# è¿è¡ŒæŒ‡å®šæµ‹è¯•
pytest test/test_message_queue.py -v
```

## ğŸ“ æ·»åŠ æ–°æµ‹è¯• / Adding New Tests

1. åœ¨ `test/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶
2. æ–‡ä»¶åä»¥ `test_` å¼€å¤´
3. å‚è€ƒç°æœ‰æµ‹è¯•æ–‡ä»¶çš„ç»“æ„

ç¤ºä¾‹:
```python
# test/test_new_feature.py
from app.your_module import your_function
from app.log import logger

def test_basic_functionality():
    """æµ‹è¯•åŸºæœ¬åŠŸèƒ½"""
    result = your_function()
    assert result is not None
    logger.success("æµ‹è¯•é€šè¿‡")

if __name__ == "__main__":
    test_basic_functionality()
```

## ğŸ§ª æµ‹è¯•æœ€ä½³å®è·µ / Testing Best Practices

1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ,ä¸ä¾èµ–å…¶ä»–æµ‹è¯•
2. **æ¸…ç†**: æµ‹è¯•åæ¸…ç†åˆ›å»ºçš„æ•°æ®å’Œèµ„æº
3. **æ—¥å¿—**: ä½¿ç”¨ logger è®°å½•æµ‹è¯•è¿‡ç¨‹
4. **æ–­è¨€**: ä½¿ç”¨ assert éªŒè¯æµ‹è¯•ç»“æœ
5. **æ–‡æ¡£**: ä¸ºæ¯ä¸ªæµ‹è¯•å‡½æ•°æ·»åŠ è¯´æ˜

## ğŸ” æµ‹è¯•è¦†ç›–ç‡ / Test Coverage

### å½“å‰æµ‹è¯•è¦†ç›–:
- âœ… æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒåŠŸèƒ½
- âœ… å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
- âœ… ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
- âœ… å…¬å…±ä¿¡æ¯å­˜å‚¨
- â³ APIè·¯ç”±æµ‹è¯• (å¾…æ·»åŠ )
- â³ æ•°æ®åº“æ“ä½œæµ‹è¯• (å¾…æ·»åŠ )
- â³ éŸ³ä¹æ‰«æåŠŸèƒ½æµ‹è¯• (å¾…æ·»åŠ )

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š (å¯é€‰):
```bash
pip install pytest-cov
pytest test/ --cov=app --cov-report=html
```

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹ / Test Results Example

### test_message_queue.py è¾“å‡º:
```
===== æµ‹è¯•1: åŸºæœ¬é˜Ÿåˆ—åŠŸèƒ½ =====
âœ“ ä»»åŠ¡å·²æ¨å…¥é˜Ÿåˆ—: task-123
âœ“ Worker-1 å¤„ç†ä»»åŠ¡å®Œæˆ
âœ“ é˜Ÿåˆ—å¤§å°: 0

===== æµ‹è¯•2: å…¬å…±ä¿¡æ¯å­˜å‚¨ =====
âœ“ API Key å·²è®¾ç½®
âœ“ Session Cookie å·²è®¾ç½® (TTL: 5s)
âœ“ 5ç§’åè¿‡æœŸæµ‹è¯•é€šè¿‡

===== æµ‹è¯•3: å¤šå·¥ä½œçº¿ç¨‹ =====
âœ“ å·²å¯åŠ¨3ä¸ªWorker
âœ“ å·²æ¨å…¥10ä¸ªä»»åŠ¡
âœ“ æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæˆ

âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ
```

### test_scheduler.py è¾“å‡º:
```
===== æµ‹è¯•1: é—´éš”è°ƒåº¦ä»»åŠ¡ =====
âœ“ å·²æ·»åŠ é—´éš”ä»»åŠ¡: task-456
âœ“ ä»»åŠ¡å°†æ¯30ç§’æ‰§è¡Œä¸€æ¬¡

===== æµ‹è¯•2: å•æ¬¡æ‰§è¡Œä»»åŠ¡ =====
âœ“ å·²æ·»åŠ å•æ¬¡ä»»åŠ¡: task-789
âœ“ å°†åœ¨5ç§’åæ‰§è¡Œ

===== æµ‹è¯•3: Cronè¡¨è¾¾å¼ä»»åŠ¡ =====
âœ“ å·²æ·»åŠ Cronä»»åŠ¡: task-abc
âœ“ æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡

===== æµ‹è¯•4: ä»»åŠ¡ç®¡ç† =====
âœ“ ä»»åŠ¡å·²æš‚åœ
âœ“ ä»»åŠ¡å·²æ¢å¤
âœ“ ä»»åŠ¡å·²åˆ é™¤

âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ
```

## ğŸ› è°ƒè¯•æµ‹è¯• / Debugging Tests

### å¯ç”¨è¯¦ç»†æ—¥å¿—:
```python
from app.log import logger

# åœ¨æµ‹è¯•æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
logger.remove()
logger.add(sys.stdout, level="DEBUG")
```

### ä½¿ç”¨æ–­ç‚¹è°ƒè¯•:
```python
import pdb

def test_something():
    pdb.set_trace()  # åœ¨æ­¤å¤„æš‚åœ
    # æµ‹è¯•ä»£ç ...
```

### VS Code è°ƒè¯•é…ç½®:
```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: å½“å‰æµ‹è¯•æ–‡ä»¶",
            "type": "python",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal"
        }
    ]
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£ / Related Documentation

- [æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨æ–‡æ¡£](../docs/message_queue_usage.md)
- [å®šæ—¶è°ƒåº¦å™¨æ–‡æ¡£](../docs/scheduler_usage.md)
- [å®Œæ•´ç³»ç»Ÿæ–‡æ¡£](../docs/README.md)
